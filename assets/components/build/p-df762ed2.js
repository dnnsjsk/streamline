import{q as e,t as n,a as t,u as r,d as o,v as c,w as s,x as a,b as i}from"./p-121838d7.js";function l(n){const t=e(n);return function(e,r,o){let c;return r=n.iteratee(r),o?void 0!==(o=n.cloneDeep(o)).leafsOnly&&(o.leavesOnly=o.leafsOnly):o={},o=n.merge({checkCircular:!1,leavesOnly:void 0===o.childrenPath,pathFormat:"string"},o),t(e,((e,n,t,o)=>{if(r(e,n,t,o))return c={value:e,key:n,parent:t,context:o},o.break()}),{pathFormat:o.pathFormat,checkCircular:o.checkCircular,ownPropertiesOnly:o.ownPropertiesOnly,childrenPath:o.childrenPath,includeRoot:o.includeRoot,rootIsChildren:o.rootIsChildren,callbackAfterIterate:!1,leavesOnly:o.leavesOnly}),c}}const d=l(n),u=function(){const e=l(n);return function(n,t,r){return!!e(n,t,r)}}();function h(e){t.isProcessing=!0;const n=window.streamline||!1;fetch(n.ajax,{method:"POST",credentials:"same-origin",headers:new Headers({"Content-Type":"application/x-www-form-urlencoded"}),body:`action=streamlineQuery&type=${e.type}&query=${JSON.stringify(e.query)}&nonce=${n.nonce}&userId=${String(t.data.userId)}`}).then((e=>e&&e.json())).then((()=>{t.isProcessing=!1,e.callback&&e.callback()})).catch((()=>{console.log()}))}function f(e){for(var n=-1,t=null==e?0:e.length,r=0,o=[];++n<t;){var c=e[n];c&&(o[r++]=c)}return o}function p(e){const n=[...t.entriesFav],l=r(t[`entries${o(e.type)}`],(n=>e.filter(n)),{childrenPath:["children"]});if(e.favourite){const r=d(t.entriesFav,(n=>e.pathFav(n)),{childrenPath:["children"]});s(n,r.context._item.strPath);const o=r.context._item.parent.path;0===Object.values(a(t.entriesFav,`${o}.children`)).length&&s(n,o);const c=r.context._item.parent.parent.path;0===(!!c&&Object.values(a(t.entriesFav,`${c}.children`)).length)&&s(n,c);const l=1===n.length&&void 0===n[0]?[]:[...f(n)];t.entriesFav=l,t.entriesFavActive=l,i()}else{const r=d(t.entriesFav,(n=>e.path(n)),{childrenPath:["children"]}),o=null==r?void 0:r.key;if(0===t.entriesFav.length){const e=[...c(t.entriesFav,l)];t.entriesFav=e,t.entriesFavActive=e}else if(r){const e=c([Object.assign({},n[o])],l);n[o]=e[0],t.entriesFav=n,t.entriesFavActive=n}else{const e=[...n,l[0]];t.entriesFav=e,t.entriesFavActive=e}}t.test||h({type:"favourites",query:t.entriesFav}),e.callback&&e.callback()}export{p as a,d as b,h as f,u as s}